<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="http://code.jquery.com/jquery-3.1.0.js" integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk=" crossorigin="anonymous"></script>
	<script src="http://code.jquery.com/ui/1.12.0/jquery-ui.js" integrity="sha256-0YPKAwZP7Mp3ALMRVB2i8GXeEndvCq3eSl/WsAl1Ryk=" crossorigin="anonymous"></script>
	<link rel="stylesheet" type="text/css" href="ph-buttons.css">
	<style type="text/css">
		
		#outbox {
			border: 4px solid black;
			width: 1200px;
			display: inline-block;
			overflow:hidden;

		}
		#titlebar {
			text-align: center;
			width:1200px;
		}
		canvas {
			float:left;
			border: 4px solid black;
			/*margin: 60px 50px 100px 230px;*/
			margin-top:60px;
			margin-right:50px;
			margin-bottom:100px;
			margin-left:70px;
			overflow:hidden;

		}		
		#btn_panel_left {
			border:1px dotted black;
			vertical-align: middle;
			display: inline-block;
			float:left;
			margin-top:70px;
			width:180px;
			height:100%;
		}
		#btn_panel_left>* {
		    width:100px;
		    margin-left:30px;
		}
		#color_panel>* {
			width:30px;
			height:30px;
			background-color: black;
			float:left;
			margin:1.5px;
		}
		#color_panel {

			margin-top: 10px;
			margin-bottom: 2.5cm;
		}

		#box_black {
			background-color: black;
		}
		#box_red {
			background-color: red;
		}
		#box_green {
			background-color: green;
		}
		#box_blue {
			background-color: blue;
		}
		#box_brown {
			background-color: brown;
		}
		#box_purple {
			background-color: purple;
		}
		#bth_panel_bottom {
			/*width:1200px;	*/
			align-content: center;
			float:left;
			overflow:hidden;
			display: inline-block;
			margin-left:500px;
		}
		#bth_panel_bottom>* {
			float:left;
			/*vertical-align: middle;*/
			margin:10px;
			width:100px;
			
		}
		#thick_panel {
			width:80px;
		}
		#thick_panel>* {
			background-color: black;
			margin:10px;
		}
		#line_thick1 {
			height: 2px;
		}
		#line_thick2 {
			height: 4px;
		}
		#line_thick3 {
			height: 6px;
		}
		#line_thick4 {
			height: 8px;
		}
	</style>
	<script type="text/javascript">
		var ctx;
		var vertex_buffer = new Array();
		var draw_mode = 0x00;
		var LEFT_CLICK = 0,
		 	RIGHT_CLICK = 2;
		const MODE_NO_DRAW = 0x00,
			  MODE_SEGMENT = 0x01,
			  MODE_CIRCLE = 0x02,
			  MODE_QUAD = 0x04,
			  MODE_POLYGON = 0x08,
			  MODE_CURVE = 0x10;
		var line_thickness = 2;
		const COLOR_RED = "rgba(255,0,0,1.0)",
			  COLOR_BLACK = "rgba(0,0,0,1.0)",
			  COLOR_GREEN = "rgba(0,128,0,1.0)",
			  COLOR_BLUE = "rgba(0,0,255,1)",
			  COLOR_BROWN = "rgba(128,0,0,1)",
			  COLOR_PURPLE = "rgba(128,0,128,1)";
		var line_color = COLOR_BLACK;
		var pattern_color = COLOR_BLACK;

		function start() {
			var canvas = document.getElementById("canvas");
			ctx = canvas.getContext("2d");
			canvas.addEventListener('mousedown', get_vertex);
			canvas.addEventListener('mouseup', draw_vertex);
		
		}
		function select_lcolor(v) {
			line_color = v.getAttribute("lcolor");
			console.log("line color : " + line_color);
		}
		function select_lthick(v) {
			line_thickness = v.getAttribute("lthick");
			console.log("line thickness : " + line_thickness);
		}
		function select_pcolor(v) {
			pattern_color = v.getAttribute("pcolor");
			console.log("pattern color : " + pattern_color);
		}
		function get_vertex(event) {
			if (draw_mode == MODE_NO_DRAW) {
				console.log("No draw mode");
				return;
			}
			if (event.button == LEFT_CLICK) {
				var xy = get_mouse_position(canvas, event);
				console.log(xy[0] + ":" + xy[1]);		
				vertex_buffer.push(xy);
			} else if (event.button == RIGHT_CLICK) {

			}
		}
		function draw_vertex(event) {
			if (draw_mode == MODE_NO_DRAW) {
				console.log("No draw mode");
				return;
			}
			if (event.button == LEFT_CLICK) {
				var xy = get_mouse_position(canvas, event);
				console.log(xy[0] + ":" + xy[1]);
				vertex_buffer.push(xy);
				draw_shapes(draw_mode);
			} else if (event.button == RIGHT_CLICK) {
					
			}
		}
		function draw_shapes(mode) {
			switch (mode) {
				case MODE_SEGMENT:
					draw_segment();
					break;
				case MODE_CIRCLE:
					draw_circle();
					break;
				case MODE_QUAD:
					draw_quad();
					break;
				case MODE_POLYGON:
					draw_polygon();
					break;
				case MODE_CURVE:
					draw_curve();
					break;
				default:
					console.log("nothing selected");
			}
		}
		function get_mouse_position(canvas, event) {
			var rect = canvas.getBoundingClientRect();
			var x = event.clientX - rect.left;
			var y = event.clientY - rect.top;	
			return [x,y];
		}
		function switch_draw_mode(MODE) {
			draw_mode = MODE;
			console.log("switch draw mode : " + draw_mode);
		}
		function draw_segment() {
			var seg = get2vertex();
			var src = seg[0],
				dst = seg[1];
			// vertex_buffer.pop();
			// vertex_buffer.pop();
			ctx.beginPath();
			ctx.moveTo(src[0], src[1]);
			ctx.lineTo(dst[0], dst[1]);
			ctx.lineWidth = line_thickness;
			ctx.strokeStyle = line_color;
			ctx.stroke();
			ctx.closePath();
			console.log("drawSegment");
			console.log("lineColor:" + line_color);
			console.log("lineWidth:" + line_thickness);
		}
		// get 2 vertexes, which is recently pushed from vertex buffer 
		function get2vertex() {
			return [
				vertex_buffer[vertex_buffer.length-2],
				vertex_buffer[vertex_buffer.length-1]
			];
		}
		function draw_circle() {
			var cir = get2vertex();
			var center = cir[0];
			var radius = distance_p2p(cir[0], cir[1]);
			ctx.beginPath();
			ctx.arc(center[0], center[1], radius, 0, 2*Math.PI, false);
			ctx.fillStyle = pattern_color;
			ctx.fill();
			ctx.lineWidth = line_thickness;
			ctx.strokeStyle = line_color;
			ctx.stroke();
			console.log("drawCircle");
			console.log("center:" + center[0] + "," + center[1]);
			console.log("radius:" + radius);
		}
		function distance_p2p(p1, p2) {
			return Math.sqrt(Math.pow(p1[0]-p2[0], 2) + Math.pow(p1[1]-p2[1], 2));
		}
		function draw_quad() {
		}
		function draw_polygon() {
		}
		function draw_curve() {
		}
		function fill_color() {
		}
		function fill_pattern() {
		}
	</script>
	<title>2D Simple Graphic Editor</title>

</head>
<body oncontextmenu="return false;" onload="start()">
	<p id="titlebar"><b>2D Simple Graphic Editor</b></p>
	<div id="outbox">
		<div id="btn_panel_left">
		
		        <div id="btn_segment" class='ph-button ph-btn-red' onclick="switch_draw_mode(0x01)">선분</div>
		        <div id="btn_circle" class='ph-button ph-btn-red' onclick="switch_draw_mode(0x02)">원</div>
		        <div id="btn_quad" class='ph-button ph-btn-red' onclick="switch_draw_mode(0x04)">사각형</div>
		        <div id="btn_polygon" class='ph-button ph-btn-red' onclick="switch_draw_mode(0x08)">다각형</div>
		        <div id="btn_curve" class='ph-button ph-btn-red' onclick="switch_draw_mode(0x10)">곡선</div>
		        <div id="btn_fillcolor" class='ph-button ph-btn-red' onclick="fill_color()">색 채우기</div>
		     <div id="color_panel">
		        	<div id="box_black" onclick="select_pcolor(this)" pcolor="black"></div>
		        	<div id="box_red" onclick="select_pcolor(this)" pcolor="red"></div>
		        	<div id="box_green" onclick="select_pcolor(this)" pcolor="green"></div>
		        	<div id="box_blue" onclick="select_pcolor(this)" pcolor="blue"></div>
		        	<div id="box_brown" onclick="select_pcolor(this)" pcolor="brown"></div>
		        	<div id="box_purple" onclick="select_pcolor(this)" pcolor="purple"></div>
		     </div>
		        <div id="btn_pattern" class='ph-button ph-btn-red' onclick="fill_pattern()">패턴</div>
		        <p><b>선 색</b></p>
		        <div id="color_panel">
		        	<div id="box_black" onclick="select_lcolor(this)" lcolor="black"></div>
		        	<div id="box_red" onclick="select_lcolor(this)" lcolor="red"></div>
		        	<div id="box_green" onclick="select_lcolor(this)" lcolor="green"></div>
		        	<div id="box_blue" onclick="select_lcolor(this)" lcolor="blue"></div>
		        	<div id="box_brown" onclick="select_lcolor(this)" lcolor="brown"></div>
		        	<div id="box_purple" onclick="select_lcolor(this)" lcolor="purple"></div>

		        </div>
		        <p><b>선 굵기</b></p>
		        <div id="thick_panel">
		        	<div id="line_thick1" onclick="select_lthick(this)" lthick="2"></div>
		        	<div id="line_thick2" onclick="select_lthick(this)" lthick="4"></div>
		        	<div id="line_thick3" onclick="select_lthick(this)" lthick="6"></div>
		        	<div id="line_thick4" onclick="select_lthick(this)" lthick="8"></div>
		        </div>
		</div>

		<canvas id="canvas" width="830" height="700">This browser doesn't support canvas. Use another browser.</canvas>
		<div id="bth_panel_bottom">
			<div id="btn_load" class='ph-button ph-btn-green'>불러오기</div>
			<div id="btn_save" class='ph-button ph-btn-green'>저장</div>
		</div>
	</div>
</body>
</html>